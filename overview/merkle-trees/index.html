<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-overview/merkle-trees">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Merkle Trees | Illium Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.illium.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.illium.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.illium.org/overview/merkle-trees"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Merkle Trees | Illium Docs"><meta data-rh="true" name="description" content="Bitcoin block headers contain a field called the merkle root. The merkle root is a compact cryptographic representation of"><meta data-rh="true" property="og:description" content="Bitcoin block headers contain a field called the merkle root. The merkle root is a compact cryptographic representation of"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.illium.org/overview/merkle-trees"><link data-rh="true" rel="alternate" href="https://docs.illium.org/overview/merkle-trees" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.illium.org/overview/merkle-trees" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.dad930f1.css">
<link rel="preload" href="/assets/js/runtime~main.026be7c8.js" as="script">
<link rel="preload" href="/assets/js/main.7c8f68fa.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Illium" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Illium" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Illium</b></a><a class="navbar__item navbar__link" href="/">Overview</a><a class="navbar__item navbar__link" href="/protocol">Protocol</a><a class="navbar__item navbar__link" href="/node">Node</a><a class="navbar__item navbar__link" href="/api">API</a><a class="navbar__item navbar__link" href="/developers">Developers</a></div><div class="navbar__items navbar__items--right"><a href="https://illium.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Illium.org<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/project-illium/illium-documentation" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview/zk-snarks">zk-snarks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview/output-commitments">Output Commitments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/overview/merkle-trees">Merkle Trees</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview/lurk">Lurk</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview/transaction-validation">Transaction Validation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview/smart-contracts">Smart Contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview/assets">Assets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview/consensus">Consensus Algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview/chain-selection">Chain Selection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/overview/emission-schedule">Coin Distribution</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Merkle Trees</span><meta itemprop="position" content="1"></li></ul></nav><div class="theme-doc-markdown markdown"><h1>Merkle Trees</h1><p>Bitcoin block headers contain a field called the <code>merkle root</code>. The merkle root is a compact cryptographic representation of
the transactions contained in the block. To build the tree the transactions are first hashed, then the hashes are paired
together, concatenated, and hashed again. This process is repeated for each layer of the tree until you have a single &quot;root&quot;
hash at the top of the tree as shown below.</p><p><img loading="lazy" alt="Merkle-Tree-1" src="/assets/images/Merkle-Tree-1-5750f929363a13660354367e8eeb7510.png" width="1400" height="585" class="img_ev3q"></p><p>A unique feature of the merkle tree is that it allows us to build compact inclusion proofs. For example, if I want to
prove that transaction 6 is in the block, I could do so my providing you with the full list of transactions in the block.
That would work, you would see that, indeed, transaction 6 is in the block, but it&#x27;s not very compact. Especially
for larger blocks. </p><p>Using the merkle tree we can create a proof that is much more compact. In this case the proof would consist of:</p><ul><li>The hash of transaction 5</li><li>H78</li><li>H1234</li></ul><p>From that information a verifier could compute <code>H56</code>, <code>H5678</code>, and the <code>root</code> hash. Then compare the root hash to the hash in
the block header. </p><p>Illium also uses the exact same merkle tree to represent transactions in the block header, but in addition, at each block
we also calculate a merkle root of the entire set of transaction output commitments found in the entire blockchain. </p><p>We call this the <code>Txoc Set Root</code> (txoc stands for transaction output commitment).</p><p>Recomputing the entire merkle tree every new block would be extremely resource intensive. Even more so when one considers
that the size of the txoc set is extremely large. Much larger than the number of transactions in a block. </p><p>For this reason we use a variant of the Bitcoin merkle tree that is optimized for appends. We call this tree the <code>Txoc
Set Accumulator</code>.</p><p>It works as follows. First, when we insert a new output commitment into the tree we prepend it with its index in the tree before
hashing:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">hash </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">hash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> outputCommitment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This ensures that each hash in the tree is unique, even if the output commitment is not. </p><p>Now suppose we have four output commitments in the tree. It would look just like a normal merkle tree:</p><p><img loading="lazy" alt="Merkle-Tree-2" src="/assets/images/Merkle-Tree-2-de24943066dc7e28ca1214c334bc31a7.png" width="400" height="277" class="img_ev3q"></p><p>If we were to add a fifth output commitment we would simply leave that output loose and treat it as its own separate &quot;peak&quot;. </p><p><img loading="lazy" alt="Merkle-Tree-3" src="/assets/images/Merkle-Tree-3-40a1179871cc6f71baa1f5295f1f03c9.png" width="406" height="227" class="img_ev3q"></p><p>Now we have a tree with two &quot;peaks&quot;. We can compute the merkle root for the txoc set as the
merkle root of the set of peaks. In this case:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">root </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">hash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">peak1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> peak2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we add a sixth output commitment the second tree grows in size:</p><p><img loading="lazy" alt="Merkle-Tree-4" src="/assets/images/Merkle-Tree-4-57080bcd986098c1cb7aebb6286f592f.png" width="493" height="227" class="img_ev3q"></p><p>After a seventh output commitent we now have three peaks:</p><p><img loading="lazy" alt="Merkle-Tree-5" src="/assets/images/Merkle-Tree-5-9d6c005cb261d75dd24a764fd73d723d.png" width="608" height="227" class="img_ev3q"></p><p>Again, we compute the txoc root by building a regular merkle tree out of the peaks:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">h1 </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">hash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">peak1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> peak2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">h2 </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">hash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">peak3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> peak3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// As in bitcoin, an unpaired element gets hashed with itself.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">hash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">h1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> h2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After adding an eighth output commitment into the tree, all the peaks merge back into a single peak:</p><p><img loading="lazy" alt="Merkle-Tree-6" src="/assets/images/Merkle-Tree-6-f4cb191f1de568de9a561aa117810510.png" width="1400" height="585" class="img_ev3q"></p><p>So what we end up with is the number of peaks in the accumulator expands as the number of output commitments grows, but then
at some point it collapses back to a single peak. Each round of expansion the number of peaks grows by one. Overall the number
of peaks grows logarithmically with the number of output commitments. </p><p>Additionally, full nodes only need to store the peaks on disk in order to update the accumulator and all the intermediate
branches can be deleted. So this accumulator uses very little disk space and very little CPU to update with each new block.</p><p>Just like the original merkle tree, we can still build compact inclusion proofs which we will need later to prove
that our transaction inputs are valid.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/project-illium/illium-documentation/docs/overview/merkle-trees.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/overview/output-commitments"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Output Commitments</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/overview/lurk"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lurk</div></a></nav></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/protocol">Protocol</a></li><li class="footer__item"><a class="footer__link-item" href="/node">Node</a></li><li class="footer__item"><a class="footer__link-item" href="/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/developers">Developers</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://reddit.com/r/illium" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/yDq7KXdKmV" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/illiumcrypto" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://illium.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Illium.org<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/project-illium" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 <a href="https://illium.org" target="_blank">Illium</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.026be7c8.js"></script>
<script src="/assets/js/main.7c8f68fa.js"></script>
</body>
</html>