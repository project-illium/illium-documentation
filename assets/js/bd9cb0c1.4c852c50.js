"use strict";(self.webpackChunkillium_documentation=self.webpackChunkillium_documentation||[]).push([[7078],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>f});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(n),m=i,f=u["".concat(c,".").concat(m)]||u[m]||d[m]||r;return n?a.createElement(f,o(o({ref:t},p),{},{components:n})):a.createElement(f,o({ref:t},p))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[u]="string"==typeof e?e:i,o[1]=s;for(var l=2;l<r;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4008:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var a=n(7462),i=(n(7294),n(3905));const r={sidebar_position:3},o="Output Commitments",s={unversionedId:"overview/output-commitments",id:"overview/output-commitments",title:"Output Commitments",description:"Bitcoin",source:"@site/docs/overview/output-commitments.md",sourceDirName:"overview",slug:"/overview/output-commitments",permalink:"/overview/output-commitments",draft:!1,editUrl:"https://github.com/project-illium/illium-documentation/docs/overview/output-commitments.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"zk-snarks",permalink:"/overview/zk-snarks"},next:{title:"Merkle Trees",permalink:"/overview/merkle-trees"}},c={},l=[{value:"Bitcoin",id:"bitcoin",level:2},{value:"Illium",id:"illium",level:2},{value:"Illium Addresses",id:"illium-addresses",level:2}],p={toc:l},u="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(u,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"output-commitments"},"Output Commitments"),(0,i.kt)("h2",{id:"bitcoin"},"Bitcoin"),(0,i.kt)("p",null,"If you recall Bitcoin has multiple types of addresses: pay-to-pubkeyhash, pay-to-scripthash, pay-to-witness-pubkeyhash, etc."),(0,i.kt)("p",null,"Let's focus on the pay-to-scripthash as this one most closely relates to Illium. "),(0,i.kt)("p",null,"In a pay-to-scripthash address the address is a serialized hash of a custom, user-defined, locking script. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"scriptHash := hash160(lockingScript)\naddress := serialize(scriptHash)\n")),(0,i.kt)("p",null,"You may also recall that Bitcoin transactions roughly look like the following (in JSON):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "inputs": [\n    {\n      "prev_hash": "4dd8bc776abd45aa9df7186966fa0733ad28aeab1bac0860d2316a051e65c6d2",\n      "output_index": 1,\n      "signatue_script": "47304402203b39d75ef932b9192b89dc2ba74e76611f552ef7167e74d55ef5e6822740a8140220063231351174d6c31ca15b7da1d8d60cc8f8a764fd578a9a11c1b564522c512b01210391adc032a6cd78870d5ec400bdecc031344e96364654f1cfedb34fdbd6afaea5",\n    }\n  ],\n  "outputs": [\n    {\n      "amount": 378288,\n      "script": "a914746558be018cbbedf9d46c6df960308d3e40541687"\n    },\n    {\n      "amount": 3561267,\n      "script": "a91492b2912c8931f36bc14bfc155450ab052bcef11887"\n    }\n  ]\n}\n')),(0,i.kt)("p",null,"Transactions can have multiple ",(0,i.kt)("inlineCode",{parentName:"p"},"inputs")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"outputs"),". Each ",(0,i.kt)("inlineCode",{parentName:"p"},"input")," points to an unspent transaction output (UTXO) from\nsome prior transaction in the chain. In this sense inputs could be said to ",(0,i.kt)("em",{parentName:"p"},"spend")," outputs. Once an output has been spent\nBitcoin nodes mark it as spent and prevent future transactions from spending the ",(0,i.kt)("em",{parentName:"p"},"same")," output."),(0,i.kt)("p",null,"Notice that in the ",(0,i.kt)("inlineCode",{parentName:"p"},"outputs")," section each output declares the ",(0,i.kt)("inlineCode",{parentName:"p"},"script")," the coins are being sent to. This is the same\n",(0,i.kt)("inlineCode",{parentName:"p"},"scriptHash")," we talked about above. Outputs also declare the ",(0,i.kt)("inlineCode",{parentName:"p"},"amount")," of coins sent to this scriptHash.\nIn Bitcoin these fields are unencrypted and are publicly visible to everyone."),(0,i.kt)("h2",{id:"illium"},"Illium"),(0,i.kt)("p",null,"In Illium transactions also have outputs but we hash the output data to prevent it from being publicly visible to anyone. "),(0,i.kt)("p",null,"For example, Illium transactions look like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "outputs": [\n    {\n      "commitment": "2413fb3709b05939f04cf2e92f7d0897fc2596f9ad0b8a9ea855c7bfebaae892"\n    },\n    {\n      "commitment": "0ed3599b1d2f6f03586491cfde627e77ffe1acab0d89ac9c35d738369e4f527d"\n    }\n  ]\n}\n')),(0,i.kt)("p",null,"The commitment hash is calculated as:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"commitment := hash(scriptHash, amount)\n")),(0,i.kt)("p",null,"If you're quick on your feet you might notice a potential attack here. If you know someone's scriptHash you can try brute\nforcing the scriptHash with every possible amount and checking to see if the corresponding hash exists in the chain. This\nwould deanonymize the output. "),(0,i.kt)("p",null,"To combat this the sender of transaction generates a random number, which we call a ",(0,i.kt)("inlineCode",{parentName:"p"},"salt"),", and concatenates the ",(0,i.kt)("inlineCode",{parentName:"p"},"salt"),"\nto the ",(0,i.kt)("inlineCode",{parentName:"p"},"scriptHash")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"amount"),". This effectively randomizes the commitment and prevents the brute force attack."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"commitment := hash(scriptHash, amount, salt)\n")),(0,i.kt)("p",null,"But if the outputs are hashed with a random salt, how does the recipient know the transaction is intended for them? "),(0,i.kt)("h2",{id:"illium-addresses"},"Illium Addresses"),(0,i.kt)("p",null,'Like pay-to-scripthash Bitcoin addresses, Illium addresses also include a hash of a custom, user-defined locking script.\nAs we\'ll see later the "locking script" is actually a custom zk-snark function. The address also includes the user\'s\n"view" public key.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"scriptHash := hash(lockingScript)\naddress := serialize(scriptHash, viewPublicKey)\n")),(0,i.kt)("p",null,"To answer the question about how does the recipient know if a transaction belongs to him, the sender of the transaction\nencrypts the output commitment preimage with the recipient's ",(0,i.kt)("inlineCode",{parentName:"p"},"viewPublicKey")," found in the recipient's address and includes the ciphertext in the output."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "outputs": [\n    {\n      "commitment": "2413fb3709b05939f04cf2e92f7d0897fc2596f9ad0b8a9ea855c7bfebaae892",\n      "ciphertext": "0d0f658174373e1ac6771ffc80864cfa8e31624d366aa5df1e55346ebc0bcd64eb44e9272f741a80e041e58dcc7b2bf45ba6847ebc3fbb29f0b6d659c4ed8aa46ea1a3fb0f3dd9d540b79c8e607cf79386e7541669aff59d8965339af31afb0c37013ade50fa8f4bb7192fabf91b86a38103f1930ea8635c6f8011646b4faa41"\n    },\n    {\n      "commitment": "0ed3599b1d2f6f03586491cfde627e77ffe1acab0d89ac9c35d738369e4f527d",\n      "ciphertext": "af57fa9e01ce6febc163309be1f30b437a2ab25adfa68d664412ef5e1b4897a1c50c4c5136446f5b53b038e7ee150385878c7ac2fd0c18ae657a3e387deaf36c630930c28aa50e0852009b99cded71e3e981112e4965e7f058bab4edd45901ef664c520611137944379dbf751d336582a0498b6fba77768bddad1c96f2f69261"\n    }\n  ]\n}\n')),(0,i.kt)("p",null,"The recipient can then try to decrypt each output ciphertext in the blockchain using his ",(0,i.kt)("inlineCode",{parentName:"p"},"viewPrivateKey")," and if the ciphertext decrypts\nsuccessfully, the transaction is his."))}d.isMDXComponent=!0}}]);